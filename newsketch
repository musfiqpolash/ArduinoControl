#include <ArduinoJson.h>
StaticJsonDocument<128> doc;
JsonObject data = doc.createNestedObject("data");
String input;
int zybo_power = 13;
int pmod_pin1 = 2;
int pmod_pin2 = 3;
int pmod_pin3 = 4;
int pmod_pin4 = 5;
int pmod_pin7 = 6;
int pmod_pin8 = 7;
int pmod_pin9 = 8;
int pmod_pin10 = 9;

void setup() {
  Serial.begin(9600);
  pinMode(pmod_pin1, OUTPUT);
  pinMode(pmod_pin2, OUTPUT);
  pinMode(pmod_pin3, OUTPUT);
  pinMode(pmod_pin4, OUTPUT);
  pinMode(pmod_pin7, OUTPUT);
  pinMode(pmod_pin8, OUTPUT);
  pinMode(pmod_pin9, OUTPUT);
  pinMode(pmod_pin10, OUTPUT);
  pinMode(zybo_power, OUTPUT);
  Serial.println("initialized");
  // delay(2000);

  // jsonData();
}

void loop() {
  if (Serial.available()) {
    //input=Serial.read();
    input = Serial.readStringUntil('\n');
    // Serial.print(input);
    // Serial.print(inp["pin1"]);
    if (input == "pin1") {
      digitalWrite(pmod_pin1, HIGH);
      jsonData();
    }
    if (input == "pin7_on") {
      digitalWrite(pmod_pin7, HIGH);
      jsonData();
    }
  }
  //delay(5000);
}

void jsonData() {
  doc["sensor"] = "gps";
  doc["time"] = 1351824120;


  data["pin1"] = digitalRead(pmod_pin1);
  data["pin2"] = digitalRead(pmod_pin2);
  data["pin3"] = digitalRead(pmod_pin3);
  data["pin4"] = digitalRead(pmod_pin4);
  data["pin7"] = digitalRead(pmod_pin7);
  data["pin8"] = digitalRead(pmod_pin8);
  data["pin9"] = digitalRead(pmod_pin9);
  data["pin10"] = digitalRead(pmod_pin10);
  data["power"] = digitalRead(zybo_power);

  serializeJson(doc, Serial);
  Serial.println();
  // serializeJsonPretty(doc, Serial);
}
